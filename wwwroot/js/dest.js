"use strict";var MoveObj=function(e){var t=void 0,n={mesh:null,init:function(){n.mesh=new THREE.Object3D,n.mesh.add(e.camera);var o=new THREE.BoxBufferGeometry(2,2,2);o.applyMatrix((new THREE.Matrix4).makeRotationX(Math.PI/4)),o.applyMatrix((new THREE.Matrix4).makeRotationZ(Math.PI/4));var a=e.skyMap;console.log("map",e);var i=new THREE.MeshLambertMaterial({color:16777215,envMap:a,reflectivity:.83});(t=new THREE.Mesh(o,i)).position.z=10,t.position.y=-10,n.mesh.add(t)},update:function(){n.mesh.rotation.y-=3e-4,t&&(t.rotation.y-=.002)}};return n.init(),n};THREE.OrbitControls=function(e,t){this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var n,o,a=this,i=new THREE.Vector2,r=new THREE.Vector2,s=new THREE.Vector2,c=new THREE.Vector2,d=new THREE.Vector2,h=new THREE.Vector2,u=new THREE.Vector3,p=new THREE.Vector3,l=new THREE.Vector2,E=new THREE.Vector2,m=new THREE.Vector2,f=0,b=0,v=1,T=new THREE.Vector3,w=new THREE.Vector3,y=new THREE.Quaternion,g={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},R=g.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom;var O=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),H=O.clone().inverse(),M={type:"change"},j={type:"start"},P={type:"end"};function k(){return 2*Math.PI/60/60*a.autoRotateSpeed}function L(){return Math.pow(.95,a.zoomSpeed)}function x(e){if(!1!==a.enabled){e.preventDefault();var t=a.domElement===document?a.domElement.body:a.domElement;if(R===g.ROTATE){if(!0===a.noRotate)return;r.set(e.clientX,e.clientY),s.subVectors(r,i),a.rotateLeft(2*Math.PI*s.x/t.clientWidth*a.rotateSpeed),a.rotateUp(2*Math.PI*s.y/t.clientHeight*a.rotateSpeed),i.copy(r)}else if(R===g.DOLLY){if(!0===a.noZoom)return;E.set(e.clientX,e.clientY),m.subVectors(E,l),m.y>0?a.dollyIn():m.y<0&&a.dollyOut(),l.copy(E)}else if(R===g.PAN){if(!0===a.noPan)return;d.set(e.clientX,e.clientY),h.subVectors(d,c),a.pan(h.x,h.y),c.copy(d)}R!==g.NONE&&a.update()}}function N(){!1!==a.enabled&&(document.removeEventListener("mousemove",x,!1),document.removeEventListener("mouseup",N,!1),a.dispatchEvent(P),R=g.NONE)}function S(e){if(!1!==a.enabled&&!0!==a.noZoom&&R===g.NONE){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?a.dollyOut():t<0&&a.dollyIn(),a.update(),a.dispatchEvent(j),a.dispatchEvent(P)}}this.rotateLeft=function(e){void 0===e&&(e=k()),b-=e},this.rotateUp=function(e){void 0===e&&(e=k()),f-=e},this.panLeft=function(e){var t=this.object.matrix.elements;u.set(t[0],t[1],t[2]),u.multiplyScalar(-e),T.add(u)},this.panUp=function(e){var t=this.object.matrix.elements;u.set(t[4],t[5],t[6]),u.multiplyScalar(e),T.add(u)},this.pan=function(e,t){var n=a.domElement===document?a.domElement.body:a.domElement;if(a.object instanceof THREE.PerspectiveCamera){var o=a.object.position.clone().sub(a.target).length();o*=Math.tan(a.object.fov/2*Math.PI/180),a.panLeft(2*e*o/n.clientHeight),a.panUp(2*t*o/n.clientHeight)}else a.object instanceof THREE.OrthographicCamera?(a.panLeft(e*(a.object.right-a.object.left)/n.clientWidth),a.panUp(t*(a.object.top-a.object.bottom)/n.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){void 0===e&&(e=L()),a.object instanceof THREE.PerspectiveCamera?v/=e:a.object instanceof THREE.OrthographicCamera?(a.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*e)),a.object.updateProjectionMatrix(),a.dispatchEvent(M)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.dollyOut=function(e){void 0===e&&(e=L()),a.object instanceof THREE.PerspectiveCamera?v*=e:a.object instanceof THREE.OrthographicCamera?(a.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/e)),a.object.updateProjectionMatrix(),a.dispatchEvent(M)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.update=function(){var e=this.object.position;p.copy(e).sub(this.target),p.applyQuaternion(O),n=Math.atan2(p.x,p.z),o=Math.atan2(Math.sqrt(p.x*p.x+p.z*p.z),p.y),this.autoRotate&&R===g.NONE&&this.rotateLeft(k()),n+=b,o+=f,n=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,n)),o=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,o)),o=Math.max(1e-6,Math.min(Math.PI-1e-6,o));var t=p.length()*v;t=Math.max(this.minDistance,Math.min(this.maxDistance,t)),this.target.add(T),p.x=t*Math.sin(o)*Math.sin(n),p.y=t*Math.cos(o),p.z=t*Math.sin(o)*Math.cos(n),p.applyQuaternion(H),e.copy(this.target).add(p),this.object.lookAt(this.target),b=0,f=0,v=1,T.set(0,0,0),(w.distanceToSquared(this.object.position)>1e-6||8*(1-y.dot(this.object.quaternion))>1e-6)&&(this.dispatchEvent(M),w.copy(this.object.position),y.copy(this.object.quaternion))},this.reset=function(){R=g.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(M),this.update()},this.getPolarAngle=function(){return o},this.getAzimuthalAngle=function(){return n},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",function(e){if(!1!==a.enabled){if(e.preventDefault(),e.button===a.mouseButtons.ORBIT){if(!0===a.noRotate)return;R=g.ROTATE,i.set(e.clientX,e.clientY)}else if(e.button===a.mouseButtons.ZOOM){if(!0===a.noZoom)return;R=g.DOLLY,l.set(e.clientX,e.clientY)}else if(e.button===a.mouseButtons.PAN){if(!0===a.noPan)return;R=g.PAN,c.set(e.clientX,e.clientY)}R!==g.NONE&&(document.addEventListener("mousemove",x,!1),document.addEventListener("mouseup",N,!1),a.dispatchEvent(j))}},!1),this.domElement.addEventListener("mousewheel",S,!1),this.domElement.addEventListener("DOMMouseScroll",S,!1),this.domElement.addEventListener("touchstart",function(e){if(!1!==a.enabled){switch(e.touches.length){case 1:if(!0===a.noRotate)return;R=g.TOUCH_ROTATE,i.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(!0===a.noZoom)return;R=g.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);l.set(0,o);break;case 3:if(!0===a.noPan)return;R=g.TOUCH_PAN,c.set(e.touches[0].pageX,e.touches[0].pageY);break;default:R=g.NONE}R!==g.NONE&&a.dispatchEvent(j)}},!1),this.domElement.addEventListener("touchend",function(){!1!==a.enabled&&(a.dispatchEvent(P),R=g.NONE)},!1),this.domElement.addEventListener("touchmove",function(e){if(!1!==a.enabled){e.preventDefault(),e.stopPropagation();var t=a.domElement===document?a.domElement.body:a.domElement;switch(e.touches.length){case 1:if(!0===a.noRotate)return;if(R!==g.TOUCH_ROTATE)return;r.set(e.touches[0].pageX,e.touches[0].pageY),s.subVectors(r,i),a.rotateLeft(2*Math.PI*s.x/t.clientWidth*a.rotateSpeed),a.rotateUp(2*Math.PI*s.y/t.clientHeight*a.rotateSpeed),i.copy(r),a.update();break;case 2:if(!0===a.noZoom)return;if(R!==g.TOUCH_DOLLY)return;var n=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,u=Math.sqrt(n*n+o*o);E.set(0,u),m.subVectors(E,l),m.y>0?a.dollyOut():m.y<0&&a.dollyIn(),l.copy(E),a.update();break;case 3:if(!0===a.noPan)return;if(R!==g.TOUCH_PAN)return;d.set(e.touches[0].pageX,e.touches[0].pageY),h.subVectors(d,c),a.pan(h.x,h.y),c.copy(d),a.update();break;default:R=g.NONE}}},!1),window.addEventListener("keydown",function(e){if(!1!==a.enabled&&!0!==a.noKeys&&!0!==a.noPan)switch(e.keyCode){case a.keys.UP:a.pan(0,a.keyPanSpeed),a.update();break;case a.keys.BOTTOM:a.pan(0,-a.keyPanSpeed),a.update();break;case a.keys.LEFT:a.pan(a.keyPanSpeed,0),a.update();break;case a.keys.RIGHT:a.pan(-a.keyPanSpeed,0),a.update()}},!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls;var Scene=function(e,t,n){var o=void 0,a=void 0,i=void 0,r={};function s(){var n=e||window.innerWidth,o=t||window.innerHeight;r.renderer.setSize(n,o),a.aspect=n/o,a.updateProjectionMatrix(),i&&i.onWindowResize()}function c(e){switch(e.keyCode){case 38:if(!r.cameraEffect)return;r.cameraEffect.shake.set(3,.3);break;case 37:if(!r.cameraEffect)return;r.cameraEffect.slow.set(10,3);break;case 39:if(!r.cameraEffect)return;r.cameraEffect.sleep.set(5);break;case 66:r.worldEffect.spawn();break;case 78:r.worldEffect.decal.reset();break;case 32:r.gunEffect.spawn()}}return r.renderer=null,r.dom=null,r.ctx=null,r.stats=null,r.scene=null,r.camera=null,r.worldEffect=null,r.gunEffect=null,r.cameraEffect=null,r.skyMap=null,r.addScene=function(){var i=e||window.innerWidth,d=t||window.innerHeight;o=new THREE.Scene,r.scene=o,r.skyMap=(new THREE.CubeTextureLoader).setPath(n).load(["pano_r.jpg","pano_l.jpg","pano_u.jpg","pano_d.jpg","pano_f.jpg","pano_b.jpg"]),o.background=r.skyMap,a=new THREE.PerspectiveCamera(60,i/d,.1,5e4),r.camera=a;r.renderer=new THREE.WebGLRenderer({alpha:!0}),r.renderer.setClearColor(5592405,1),r.renderer.shadowMap.enabled=!0,r.renderer.shadowMap.type=THREE.PCFSoftShadowMap,r.renderer.setSize(i,d),ZOribit(a,r.renderer),a.position.z=.01,window.addEventListener("resize",s,!1),document.onkeydown=c},r.init=function(){r.addScene(),function(){var e=new THREE.HemisphereLight(16775930,4539717,.9);o.add(e);var t=new THREE.DirectionalLight(13484485,.9);t.position.set(12,60,7),t.castShadow=!0,o.add(t),t.shadow.mapSize.width=256,t.shadow.mapSize.height=256,t.shadow.camera.near=.5,t.shadow.camera.far=50}()},r.update=function(){r.stats&&r.stats.update(),i?i.render():r.renderer.render(o,a)},r.add=function(e){o.add(e)},r.init(),r},ZOribit=function(e,t){var n=new THREE.OrbitControls(e,t.domElement);n.noKeys=!0,n.noPan=!0},panoMain=function(e){var t=void 0,n=void 0,o=void 0,a=[],i={},r="../img/skybox/"+(e=e||"1")+"/";function s(){i.rend(),requestAnimationFrame(s)}return i.init=function(){var e,o=document.getElementById("scene"),i=o.offsetWidth,c=o.offsetHeight;t=new Scene(i,c,r),o.appendChild(t.renderer.domElement),n=new THREE.Clock,e=new MoveObj(t),t.add(e.mesh),a.push(e.update),s()},i.rend=function(){if(t.cameraEffect){if(t.cameraEffect.slow.isStopUpdate())return;if(t.cameraEffect.sleep.isStopUpdate())return;t.cameraEffect.shake.update()}o=n.getDelta();for(var e=0;e<a.length;e++)a[e](o);t&&t.update()},i.init(),i};